--!nocheck

local hook;
local StarterGUI = game:GetService("StarterGui");

local Players = game:GetService("Players");
local Player: Player = Players.LocalPlayer;

local Insert: (<V>({V}, V) -> ()) & (<V>({V}, number, V) -> ()) = table.insert;
local Camera: Camera? = workspace.CurrentCamera;

local function HandleAdded() : ()
    local Char = Player.Character;
    local Humanoid: Humanoid = Char.Humanoid;

    local RootPart: BasePart = Char.HumanoidRootPart;
    local Connections: {RBXScriptConnection} = {};

    Insert(Connections, getconnections(Humanoid:GetPropertyChangedSignal("WalkSpeed")));
    Insert(Connections, getconnections(Humanoid:GetPropertyChangedSignal("JumpPower")));
    Insert(Connections, getconnections(Humanoid:GetPropertyChangedSignal("PlatformStand")));

    Insert(Connections, getconnections(RootPart.ChildAdded));
    Insert(Connections, getconnections(Camera:GetPropertyChangedSignal("CameraSubject")));


    for _,Base: {RBXScriptConnection} in Connections do
        for _,ActualConnection: RBXScriptConnection in Base do
            ActualConnection:Disable();
            ActualConnection = nil;
        end;
    end;
end;

hook = hookmetamethod(game, "__namecall", newcclosure(function(Self: Object, ...) : any?
    local Method: string = getnamecallmethod();
    local Args = {...};

    local IsTarget = false;
    if typeof(Args[1]) == "number" then
        IsTarget = true;
    end;

    if (Method == "FireServer" or Method == "InvokeServer" and IsTarget or tostring(Self) == "GiveAdmin") then
        StarterGUI:SetCore("SendNotification", {
            Title = "Anti cheat";
            Text = "Anti cheat tried to ban lol";
            Duration = 5
        });
        return;
    end;

    return hook(Self, ...);
end));

Player.CharacterAdded:Connect(HandleAdded);

if Player.Character then
    HandleAdded();
end;
